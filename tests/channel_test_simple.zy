<?php

echo "=== Channel 完整测试 ===\n";

// 创建带缓冲的 channel
$channel = new Channel(5);
echo "Channel 容量: " . $channel->cap() . "\n";
echo "Channel 长度: " . $channel->len() . "\n";

// 发送多个数据
echo "\n--- 发送数据 ---\n";
$data1 = "Hello";
$data2 = "World";
$data3 = "Channel";

$result1 = $channel->send($data1);
echo "发送 '{$data1}': " . ($result1 ? "成功" : "失败") . "\n";

$result2 = $channel->send($data2);
echo "发送 '{$data2}': " . ($result2 ? "成功" : "失败") . "\n";

$result3 = $channel->send($data3);
echo "发送 '{$data3}': " . ($result3 ? "成功" : "失败") . "\n";

echo "Channel 长度: " . $channel->len() . "\n";

// 接收数据
echo "\n--- 接收数据 ---\n";
$received1 = $channel->receive();
echo "接收数据1: " . $received1 . "\n";

$received2 = $channel->receive();
echo "接收数据2: " . $received2 . "\n";

$received3 = $channel->receive();
echo "接收数据3: " . $received3 . "\n";

echo "Channel 长度: " . $channel->len() . "\n";

// 检查关闭状态
echo "\n--- 关闭状态 ---\n";
echo "Channel 是否关闭: " . ($channel->isClosed() ? "是" : "否") . "\n";

// 关闭 channel
$channel->close();
echo "Channel 已关闭\n";

echo "Channel 是否关闭: " . ($channel->isClosed() ? "是" : "否") . "\n";

// 尝试向已关闭的 channel 发送数据
$result4 = $channel->send("关闭后的数据");
echo "向已关闭 channel 发送结果: " . ($result4 ? "成功" : "失败") . "\n";

echo "\n=== 测试完成 ===\n"; 